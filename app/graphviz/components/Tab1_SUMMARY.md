# Graphviz 機能1 設計まとめ

## 構想の全体像

### 目標
1. YAMLファイルを入力・管理
2. YAMLをGraphviz DOT形式に変換
3. SQLiteに保存してデータベース化
4. 将来的にナレッジグラフ化してEmbedding
5. AIアシスタントが理解・分析できるようにする

### 将来の機能
- **状況報告**: AIアシスタントがYAMLファイルの内容を理解して状況を報告
- **影響分析**: ケーブル接続変更時の影響範囲を分析
- **関連検索**: 関連するYAML/DOTファイルを検索

## 設計ドキュメント

### 1. アーキテクチャ設計
**ファイル**: `Tab1_ARCHITECTURE_DESIGN.md`

**内容**:
- データベーステーブル設計（graphvizYamlFiles, graphvizDotFiles）
- ChromaDBコレクション設計
- データフロー設計
- ID管理設計
- 既存システムとの統合

### 2. 実装計画
**ファイル**: `Tab1_IMPLEMENTATION_PLAN.md`

**内容**:
- 必要なライブラリ
- コンポーネント構造
- UIレイアウト設計
- 実装の詳細
- 実装の優先順位（Phase 1-4）

### 3. リスク分析
**ファイル**: `Tab1_RISK_ANALYSIS.md`

**内容**:
- 技術的リスク
- パフォーマンスリスク
- セキュリティリスク
- データベース統合のリスク
- 将来のナレッジグラフ化のリスク
- 実装可否の判断

## 実装フェーズ

### Phase 1: 基本機能（初期実装）
- ✅ YAML入力エディタ
- ✅ YAML→DOT変換
- ✅ Graphviz表示
- ✅ リアルタイム変換

**工数見積もり**: 13-21日（2-3週間）

### Phase 2: データベース統合
- データベーステーブル作成
- YAML/DOTファイルの保存・読み込み
- ID管理・バージョン管理

**工数見積もり**: 10-15日

### Phase 3: ChromaDB統合
- 埋め込み生成・保存
- RAG検索機能

**工数見積もり**: 8-12日

### Phase 4: ナレッジグラフ化（将来）
- YAMLからエンティティ・リレーション抽出
- 既存システムとの統合
- AIアシスタント統合

**工数見積もり**: 20-30日（要詳細設計）

## 主要な設計決定

### 1. データベース設計
- **既存システムとの統合**: 既存のorganizationsテーブルと連携
- **ID管理**: UUID形式のIDを使用
- **バージョン管理**: バージョン番号と親ファイルIDで管理

### 2. ChromaDB統合
- **コレクション命名**: `graphviz_yamls_{organizationId}`, `graphviz_dots_{organizationId}`
- **埋め込みモデル**: 既存の`text-embedding-3-small`を使用
- **同期状態管理**: 既存のパターン（chromaSynced, chromaSyncError）を活用

### 3. UI設計
- **2カラムレイアウト**: 左側にYAML入力、右側にDOTコードとグラフ表示
- **Monaco Editor**: 既存の実装パターンを活用
- **リアルタイム変換**: debounce（500ms）で実装

## リスクと対策

### 主要リスク
1. **パフォーマンス**: 大きなグラフのレンダリング
   - **対策**: ノード数制限、非同期処理

2. **データベース統合**: 既存システムへの影響
   - **対策**: 既存テーブルに影響を与えない設計

3. **ナレッジグラフ化**: 複雑なYAML構造からの抽出
   - **対策**: 明確なスキーマ定義、段階的な実装

### 総合リスク評価
- **技術的リスク**: 低〜中（対策あり）
- **パフォーマンスリスク**: 中（対策あり）
- **セキュリティリスク**: 低〜中（対策あり）
- **実現可能性**: ⭐⭐⭐⭐ (4/5) - 高い

## 次のステップ

### 1. 設計レビュー
- アーキテクチャ設計のレビュー
- データベーススキーマの確認
- 既存システムとの統合ポイントの確認

### 2. 実装開始
- Phase 1の実装開始
- 基本的なUIと変換機能の実装

### 3. 段階的な実装
- Phase 1完了後にPhase 2へ
- 各フェーズでテスト・検証
- ユーザーフィードバックの収集

## 参考資料

- **既存のデータベース設計**: `docs/database/database-design.md`
- **既存のEmbedding実装**: `lib/entityEmbeddingsChroma.ts`
- **既存のRAG検索**: `app/rag-search/`
- **既存のMonaco Editor実装**: `components/MonetizationDiagramUpdateModal.tsx`

