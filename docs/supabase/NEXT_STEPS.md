# 次のステップ - pgvector移行完了後の作業

## ✅ 完了した作業

すべてのコード移行が完了しました。以下の機能がSupabase（pgvector）対応になっています：

- ✅ エンティティ埋め込み保存・検索
- ✅ リレーション埋め込み保存・検索
- ✅ トピック埋め込み保存・検索
- ✅ システム設計ドキュメント埋め込み保存・検索

## 推奨される次のステップ

### 1. 動作テストと検証

#### 1.1 基本機能のテスト

各機能が正常に動作することを確認：

```bash
# アプリケーションを起動
npm run tauri:dev
```

**テスト項目：**

1. **エンティティ**
   - [ ] エンティティを作成して埋め込みがSupabaseに保存される
   - [ ] エンティティ検索がSupabaseを使用して動作する
   - [ ] Supabaseダッシュボードで`entity_embeddings`テーブルにデータが保存されている

2. **リレーション**
   - [ ] リレーションを作成して埋め込みがSupabaseに保存される
   - [ ] リレーション検索がSupabaseを使用して動作する
   - [ ] Supabaseダッシュボードで`relation_embeddings`テーブルにデータが保存されている

3. **トピック**
   - [ ] トピックを作成して埋め込みがSupabaseに保存される
   - [ ] トピック検索がSupabaseを使用して動作する
   - [ ] AI生成機能が正常に動作する
   - [ ] Supabaseダッシュボードで`topic_embeddings`テーブルにデータが保存されている

4. **システム設計ドキュメント**
   - [ ] システム設計ドキュメントの埋め込みがSupabaseに保存される
   - [ ] システム設計ドキュメント検索がSupabaseを使用して動作する
   - [ ] Supabaseダッシュボードで`design_doc_embeddings`テーブルにデータが保存されている

#### 1.2 エラーハンドリングの確認

- [ ] ネットワークエラー時の動作確認
- [ ] Supabase接続エラー時のフォールバック動作確認
- [ ] 埋め込み生成エラー時の動作確認

#### 1.3 パフォーマンステスト

- [ ] 検索速度の確認（ChromaDBと比較）
- [ ] 大量データでの検索パフォーマンス確認
- [ ] 同時リクエスト時のパフォーマンス確認

### 2. 既存データの移行（オプション）

ChromaDBに保存されている既存の埋め込みデータをSupabaseに移行する場合：

詳細は `scripts/supabase/migrate_chromadb_to_supabase.md` を参照してください。

**移行手順：**

1. ChromaDBから埋め込みデータをエクスポート
2. データ形式を変換（必要に応じて）
3. Supabaseにインポート
4. データの整合性を確認

**注意：**
- データ移行は時間がかかる場合があります
- 移行前にバックアップを取得してください
- 移行中はアプリケーションの使用を控えてください

### 3. 本番環境へのデプロイ準備

#### 3.1 環境変数の設定

本番環境の`.env.local`（または環境変数設定）に以下を設定：

```env
NEXT_PUBLIC_USE_SUPABASE=true
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
NEXT_PUBLIC_USE_SUPABASE_VECTOR_SEARCH=true
```

#### 3.2 インデックスの作成

本番環境でHNSWインデックスを作成（時間がかかるため事前に実行）：

```sql
-- SupabaseダッシュボードのSQL Editorで実行
-- scripts/supabase/create_vector_indexes.sql
```

**注意：**
- インデックスの作成には時間がかかります（データ量に依存）
- メンテナンスウィンドウ中に実行することを推奨

#### 3.3 バックアップ戦略の確認

- [ ] Supabaseの自動バックアップ設定を確認
- [ ] 手動バックアップの手順を確認
- [ ] 復旧手順を確認

### 4. 監視とログ

#### 4.1 ログの確認

アプリケーションのログで以下を確認：

- ベクトル検索バックエンドの切り替えログ
- Supabase接続エラーのログ
- 埋め込み保存・検索のログ

#### 4.2 監視項目

- Supabaseの使用量（ストレージ、リクエスト数）
- 検索パフォーマンス
- エラー率

### 5. ドキュメントの更新

- [ ] チーム向けの移行完了通知
- [ ] 使用方法のドキュメント更新
- [ ] トラブルシューティングガイドの更新

## トラブルシューティング

問題が発生した場合：

1. **設定確認ページで確認**
   - `/vector-search-config-check` - ベクトル検索設定確認
   - `/supabase-config-check` - Supabase設定確認

2. **ログの確認**
   - ブラウザのコンソール
   - Supabaseダッシュボードのログ

3. **ドキュメントの参照**
   - [コード移行ガイド](./CODE_MIGRATION_GUIDE.md)
   - [環境変数設定ガイド](./ENVIRONMENT_VARIABLES.md)
   - [pgvector移行ガイド](./PGVECTOR_MIGRATION_GUIDE.md)

## 完了チェックリスト

- [ ] すべての機能の動作テスト完了
- [ ] エラーハンドリングの確認完了
- [ ] パフォーマンステスト完了
- [ ] 既存データの移行完了（必要な場合）
- [ ] 本番環境へのデプロイ準備完了
- [ ] 監視とログの設定完了
- [ ] ドキュメントの更新完了

